{
  "info": {
    "name": "Account Management API Collection",
    "description": "Complete API collection for testing logout and account deletion features",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000/api",
      "type": "string"
    },
    {
      "key": "authToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "adminToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "superAdminToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "testUserId",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Setup & Authentication",
      "item": [
        {
          "name": "Request Magic Link (Customer)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"customer@example.com\",\n  \"name\": \"Test Customer\",\n  \"role\": \"customer\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/request-magic-link",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "request-magic-link"]
            }
          }
        },
        {
          "name": "Request Magic Link (Admin)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@example.com\",\n  \"name\": \"Test Admin\",\n  \"role\": \"admin\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/request-magic-link",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "request-magic-link"]
            }
          }
        },
        {
          "name": "Request Magic Link (Super Admin)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"superadmin@example.com\",\n  \"name\": \"Super Admin\",\n  \"role\": \"super_admin\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/request-magic-link",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "request-magic-link"]
            }
          }
        },
        {
          "name": "Verify Magic Link (Customer)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"your-customer-magic-token-here\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/verify-magic-link",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "verify-magic-link"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.to.have.status(200)) {",
                  "    const responseJson = pm.response.json();",
                  "    if (responseJson.data && responseJson.data.token) {",
                  "        pm.collectionVariables.set('authToken', responseJson.data.token);",
                  "        if (responseJson.data.user && responseJson.data.user.id) {",
                  "            pm.collectionVariables.set('testUserId', responseJson.data.user.id);",
                  "        }",
                  "    }",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Verify Magic Link (Super Admin)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"your-super-admin-magic-token-here\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/verify-magic-link",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "verify-magic-link"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.to.have.status(200)) {",
                  "    const responseJson = pm.response.json();",
                  "    if (responseJson.data && responseJson.data.token) {",
                  "        pm.collectionVariables.set('superAdminToken', responseJson.data.token);",
                  "    }",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Logout Management",
      "item": [
        {
          "name": "Regular Logout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"manual\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/account/logout",
              "host": ["{{baseUrl}}"],
              "path": ["account", "logout"]
            }
          }
        },
        {
          "name": "Security Logout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"security\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/account/logout",
              "host": ["{{baseUrl}}"],
              "path": ["account", "logout"]
            }
          }
        },
        {
          "name": "Get Logout History",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/account/logout-history?limit=10&offset=0",
              "host": ["{{baseUrl}}"],
              "path": ["account", "logout-history"],
              "query": [
                {
                  "key": "limit",
                  "value": "10"
                },
                {
                  "key": "offset",
                  "value": "0"
                }
              ]
            }
          }
        },
        {
          "name": "Check Token Status",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/account/token-status",
              "host": ["{{baseUrl}}"],
              "path": ["account", "token-status"]
            }
          }
        }
      ]
    },
    {
      "name": "Account Deletion",
      "item": [
        {
          "name": "Self Delete Account",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"No longer need the service\",\n  \"feedback\": \"The app was great, but I'm switching to a different solution. Thanks!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/account/delete",
              "host": ["{{baseUrl}}"],
              "path": ["account", "delete"]
            }
          }
        },
        {
          "name": "Admin Delete Account - Policy Violation",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{superAdminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{testUserId}}\",\n  \"reason\": \"policy_violation\",\n  \"notes\": \"User violated terms of service by spamming other users. Account terminated after investigation.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/account/admin/delete",
              "host": ["{{baseUrl}}"],
              "path": ["account", "admin", "delete"]
            }
          }
        }
      ]
    },
    {
      "name": "Admin Operations",
      "item": [
        {
          "name": "Force Logout User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{superAdminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{testUserId}}\",\n  \"reason\": \"Security investigation in progress. User logged out as precautionary measure.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/account/admin/force-logout",
              "host": ["{{baseUrl}}"],
              "path": ["account", "admin", "force-logout"]
            }
          }
        },
        {
          "name": "Get User by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{superAdminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/account/admin/users/{{testUserId}}",
              "host": ["{{baseUrl}}"],
              "path": ["account", "admin", "users", "{{testUserId}}"]
            }
          }
        },
        {
          "name": "Get User by ID (Include Soft Deleted)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{superAdminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/account/admin/users/{{testUserId}}?includeSoftDeleted=true",
              "host": ["{{baseUrl}}"],
              "path": ["account", "admin", "users", "{{testUserId}}"],
              "query": [
                {
                  "key": "includeSoftDeleted",
                  "value": "true"
                }
              ]
            }
          }
        },
        {
          "name": "Restore Deleted Account",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{superAdminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{testUserId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/account/admin/restore",
              "host": ["{{baseUrl}}"],
              "path": ["account", "admin", "restore"]
            }
          }
        }
      ]
    },
    {
      "name": "Analytics & Reports",
      "item": [
        {
          "name": "Get Deleted Accounts",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{superAdminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/account/admin/deleted?limit=20&offset=0",
              "host": ["{{baseUrl}}"],
              "path": ["account", "admin", "deleted"],
              "query": [
                {
                  "key": "limit",
                  "value": "20"
                },
                {
                  "key": "offset",
                  "value": "0"
                }
              ]
            }
          }
        },
        {
          "name": "Get Deleted Accounts by Specific Admin",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{superAdminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/account/admin/deleted?deletedBy=admin-uuid-here&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["account", "admin", "deleted"],
              "query": [
                {
                  "key": "deletedBy",
                  "value": "admin-uuid-here"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            }
          }
        },
        {
          "name": "Get Account Deletion Statistics",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{superAdminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/account/admin/deletion-stats",
              "host": ["{{baseUrl}}"],
              "path": ["account", "admin", "deletion-stats"]
            }
          }
        }
      ]
    },
    {
      "name": "Error Scenarios",
      "item": [
        {
          "name": "Logout with Invalid Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer invalid-token-12345"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"manual\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/account/logout",
              "host": ["{{baseUrl}}"],
              "path": ["account", "logout"]
            }
          }
        },
        {
          "name": "Logout with No Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"manual\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/account/logout",
              "host": ["{{baseUrl}}"],
              "path": ["account", "logout"]
            }
          }
        },
        {
          "name": "Delete Account with Invalid Reason",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{superAdminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{testUserId}}\",\n  \"reason\": \"invalid_reason\",\n  \"notes\": \"This should fail validation\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/account/admin/delete",
              "host": ["{{baseUrl}}"],
              "path": ["account", "admin", "delete"]
            }
          }
        },
        {
          "name": "Force Logout Non-existent User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{superAdminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"00000000-0000-0000-0000-000000000000\",\n  \"reason\": \"This should fail\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/account/admin/force-logout",
              "host": ["{{baseUrl}}"],
              "path": ["account", "admin", "force-logout"]
            }
          }
        },
        {
          "name": "Admin Delete Own Account (Should Fail)",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{superAdminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"current-user-id\",\n  \"reason\": \"admin_action\",\n  \"notes\": \"Trying to delete own account\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/account/admin/delete",
              "host": ["{{baseUrl}}"],
              "path": ["account", "admin", "delete"]
            }
          }
        },
        {
          "name": "Restore Non-existent Account",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{superAdminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"00000000-0000-0000-0000-000000000000\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/account/admin/restore",
              "host": ["{{baseUrl}}"],
              "path": ["account", "admin", "restore"]
            }
          }
        },
        {
          "name": "Access Admin Endpoint with Customer Token",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/account/admin/deleted",
              "host": ["{{baseUrl}}"],
              "path": ["account", "admin", "deleted"]
            }
          }
        },
        {
          "name": "Use Blacklisted Token",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/account/token-status",
              "host": ["{{baseUrl}}"],
              "path": ["account", "token-status"]
            }
          },
          "description": "This should fail if the token was used in a previous logout test"
        }
      ]
    },
    {
      "name": "Integration Tests",
      "item": [
        {
          "name": "Complete Flow - Create, Delete, Restore",
          "item": [
            {
              "name": "1. Create Test User",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"email\": \"testflow@example.com\",\n  \"name\": \"Test Flow User\",\n  \"role\": \"customer\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/auth/request-magic-link",
                  "host": ["{{baseUrl}}"],
                  "path": ["auth", "request-magic-link"]
                }
              }
            },
            {
              "name": "2. Verify and Login",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"token\": \"magic-token-here\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/auth/verify-magic-link",
                  "host": ["{{baseUrl}}"],
                  "path": ["auth", "verify-magic-link"]
                }
              }
            },
            {
              "name": "3. Admin Delete Account",
              "request": {
                "method": "DELETE",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{superAdminToken}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"userId\": \"user-id-from-step-2\",\n  \"reason\": \"admin_action\",\n  \"notes\": \"Test deletion for integration flow\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/account/admin/delete",
                  "host": ["{{baseUrl}}"],
                  "path": ["account", "admin", "delete"]
                }
              }
            },
            {
              "name": "4. Verify Deletion",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{superAdminToken}}"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/account/admin/users/user-id-here?includeSoftDeleted=true",
                  "host": ["{{baseUrl}}"],
                  "path": ["account", "admin", "users", "user-id-here"],
                  "query": [
                    {
                      "key": "includeSoftDeleted",
                      "value": "true"
                    }
                  ]
                }
              }
            },
            {
              "name": "5. Restore Account",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{superAdminToken}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"userId\": \"user-id-from-step-2\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/account/admin/restore",
                  "host": ["{{baseUrl}}"],
                  "path": ["account", "admin", "restore"]
                }
              }
            },
            {
              "name": "6. Verify Restoration",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{superAdminToken}}"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/account/admin/users/user-id-here",
                  "host": ["{{baseUrl}}"],
                  "path": ["account", "admin", "users", "user-id-here"]
                }
              }
            }
          ]
        }
      ]
    }
  ]
}
